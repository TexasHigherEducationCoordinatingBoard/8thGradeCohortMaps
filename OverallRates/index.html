<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8' />
  <title>8th Grade Cohort Enrollment and Completion Rates</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.42.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.42.0/mapbox-gl.css' rel='stylesheet' />
  <link href='overall.css' rel='stylesheet' />
  <style>
   
  </style>
  <script type="text/javascript" src="../cohortMapStyle.js"></script>
 
</head>

<body>
    <nav id="menu"></nav>
    
  <div id="map"></div>
  <div class='map-overlay' id='features'><div id='pd'><h2>Eighth Grade Cohort</h2><p>Hover over a region!</p></div></div>
  <div class='map-overlay legend' id='enrollLegend'>
      <h4>Enrollment Rates</h4>
    <div><span style='background-color: #08519c'></span>57%</div>
    <div><span style='background-color: #3182bd'></span>55%</div>
    <div><span style='background-color: #6baed6'></span>53%</div>
    <div><span style='background-color: #9ecae1'></span>51%</div>
    <div><span style='background-color: #c6dbef'></span>49%</div>
  </div>
  <div class='map-overlay legend' id='compLegend' style='display: none'>
      <h4>Completion Rates</h4>
    <div><span style='background-color: #006837'></span>23%</div>
    <div><span style='background-color: #31a354'></span>21%</div>
    <div><span style='background-color: #78c679'></span>19%</div>
    <div><span style='background-color: #c2e699'></span>17%</div>
  </div>

     <script type="text/javascript" src="overall.js"></script>
    
    <script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoiam9obmRpbm5pbmciLCJhIjoiY2oxazR5NjNvMDFveDJ5b2FzbWZwbjFpbiJ9.bixlFwP8Kf43qHa7Z6XK8g';
    var map = new mapboxgl.Map({
      container: 'map',
      style: cohortStyle,
      center: [-101.8, 31.9], //offset to make room for info window
      zoom: 5,
      maxZoom: 7,
      minZoom: 3,
      maxBounds: [[-140, 15], [-60, 45]]
    });

    map.on('load', function () {
      map.addSource('Cohort', {
        'type': 'vector',
        'url': 'mapbox://johndinning.9koks5ed'
      });
      map.addControl(new mapboxgl.NavigationControl({position:'top-right' }));
      // Disable map rotation using right click + drag
      map.dragRotate.disable();
      // Disable map rotation using touch rotation gesture
      map.touchZoomRotate.disableRotation();
      map.getCanvas().style.cursor = 'default'; //keep pointer
      map.scrollZoom.disable(); //no mousewheel zoom
      addLayerNav(map);
      map.addLayer({
        'id': 'TotpComp',
        'type': 'fill',
        'source': 'Cohort',
        'source-layer': 'CohortTEARegionPolys',
        "layout": {
          'visibility': 'none'
        },
        'paint': {
          'fill-color': {
            property: 'TotpComp', 
            type: 'exponential',
            stops: [
            [17, '#c2e699'],
            [19, '#78c679'],
            [21, '#31a354'],
            [23, '#006837']
            ],
          },
        }
      }, 'motorway-casing-Major'
      );
      map.addLayer({
        "id": "TotpCompText",
        "type": "symbol",
        "source": "Cohort",
        "source-layer": "CohortTEARegionPoints",
        "maxzoom": 6.4,
        "layout": {
          'visibility': 'none',
          "text-field": "{TotpComp_}" + "%",
          "text-font": [
            "DIN Offc Pro Medium",
            "Arial Unicode MS Bold"
          ],
          "text-size": 12
        }
      }
      );

      map.addLayer({
        'id': 'TotpEnroll',
        'type': 'fill',
        'source': 'Cohort',
        'source-layer': 'CohortTEARegionPolys',
        "layout": {
          'visibility': 'visible'
        },
        'paint': {
          'fill-color': {
            property: 'TotpEnr',
            stops: [
              [49,'#c6dbef'],
              [51, '#9ecae1'],
              [53, '#6baed6'],
              [55, '#3182bd'],
              [57, '#08519c']
            ],
          },
        }
      }, 'motorway-casing-Major'
      );
      map.addLayer({
        "id": "TotpEnrollText",
        "type": "symbol",
        "source": "Cohort",
        "source-layer": "CohortTEARegionPoints",
        "maxzoom": 6.4,
        "layout": {
          'visibility': 'visible',
          "text-field": "{TotpEnr_}" + "%",
          "text-font": [
            "DIN Offc Pro Medium",
            "Arial Unicode MS Bold"
          ],
          "text-size": 12
        }
      }
      );
      map.addLayer({
        "id": "RegionLines",
        "type": "line",
        "source": "Cohort",
        "source-layer": "CohortTEARegionPolys",
        "layout": {'visibility': 'visible'},
        paint: {
          "line-color": "#808080",
          "line-width": 1,
          "line-opacity": 0.6
          }
        }, 'motorway-casing-Major'); 
      map.addLayer({
        "id": "TexasOutline",
        "type": "line",
        "source": {
          'type': 'vector',
          'url': 'mapbox://johndinning.7rzn4kl6'
          },
        'source-layer': 'Texas-d92wyb',
        "paint": {
          "line-color": "rgba(0,0,0, 1)",
          "line-width": 2,
          "line-opacity": 0.7
        }
      }, 'motorway-casing-Major');
    map.addLayer({
      "id": "highlight-hover",
        "type": "fill",
        "source": "Cohort",
        'source-layer': 'CohortTEARegionPolys',
        "paint": {
            "fill-color": "#692a85",
            "fill-opacity": 1
    },
        "filter": ['==',"TEAReg", ""]
      }, 'motorway-casing-Major');
    map.fitBounds(bbox, linear=true); //fit Texas at any zoom and ease to
  });

// For the Info Window
map.on('mousemove', function(e) {
    var region = map.queryRenderedFeatures(e.point, {
      layers: ['TotpComp', 'TotpEnroll']
    });

    if ((region.length > 0) && (document.getElementById("menu").firstChild.className=='active')) {
      document.getElementById('pd').innerHTML = '<p><em>There were ' + region[0].properties.TotCoho.toLocaleString() + ' eighth-graders in the <strong>' + region[0].properties.RegName + ' Region</strong> in the 2006-07 school year. By the spring of 2016, <strong>' + region[0].properties.TotpEnr_ + 'percent had enrolled in a Texas college or university.</strong></em></p>';
    } else if ((region.length > 0) && (document.getElementById("menu").lastChild.className=='active')) {
      document.getElementById('pd').innerHTML = '<p><em>There were ' + region[0].properties.TotCoho.toLocaleString() + ' eighth-graders in the <strong>' + region[0].properties.RegName + ' Region</strong> in the 2006-07 school year. By the spring of 2016, <strong>' + region[0].properties.TotpComp_ + 'percent had completed a higher ed degree or certificate in a Texas.</strong></em></p>';
    } else {
      document.getElementById('pd').innerHTML = '<h2>Eighth Grade Cohort</h2><p>Hover over a region!</p>';
    }
  });

  map.on("mousemove", "TotpComp", function(e) {
    map.setFilter("highlight-hover", ["==", "TEAReg", e.features[0].properties["TEAReg"]]);;
  });

  map.on("mouseleave", "TotpComp", function(e) {
    map.setFilter("highlight-hover", ["==", "TEAReg",""]);;
  });

  map.on("mousemove", "TotpEnroll", function(e) {
    map.setFilter("highlight-hover", ["==", "TEAReg", e.features[0].properties["TEAReg"]]);;
  });

  map.on("mouseleave", "TotpEnroll", function(e) {
    map.setFilter("highlight-hover", ["==", "TEAReg",""]);;
  });
// </script>
</body>
</html>