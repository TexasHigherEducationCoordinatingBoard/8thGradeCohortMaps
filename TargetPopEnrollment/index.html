<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8' />
  <title>Enrollment</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.42.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.42.0/mapbox-gl.css' rel='stylesheet' />
  <link href='style.css' rel='stylesheet' />
  <style>
   
  </style>
  <script type="text/javascript" src="../cohortMapStyle.js"></script>
  <script type="text/javascript" src="Enrollment.js"></script>
</head>

<body>

  <nav id="menu"></nav>
  <div id="map"></div>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoiam9obmRpbm5pbmciLCJhIjoiY2oxazR5NjNvMDFveDJ5b2FzbWZwbjFpbiJ9.bixlFwP8Kf43qHa7Z6XK8g';
    var map = new mapboxgl.Map({
      container: 'map',
      style: cohortStyle,
      center: [-99.19, 31.30],
      zoom: 5,
      maxZoom: 15,
      minZoom: 3,
      maxBounds: [[-140, 15], [-60, 45]]
    });

    map.on('load', function () {
      map.addSource('Cohort', {
        'type': 'vector',
        'url': 'mapbox://johndinning.cvggpjmd'
      });
      map.addControl(new mapboxgl.NavigationControl({position:'top-right' }));
      // Disable map rotation using right click + drag
      map.dragRotate.disable();
      // Disable map rotation using touch rotation gesture
      map.touchZoomRotate.disableRotation();
      addLayerNav(map); // The funtions defined in the separate js doc
      map.scrollZoom.disable();
      map.fitBounds(bbox, linear=true); //fit Texas at any zoom and ease to
      map.addLayer({
        'id': 'AApEnrollDiff',
        'type': 'fill',
        'source': 'Cohort',
        'source-layer': 'Cohort2006TEARegionPolys',
        "layout": {
          'visibility': 'visible'
        },
        'paint': {
          'fill-color': {
            property: 'AAEnrpDi', //Perc Point difference in enrollment
            type: 'exponential',
            stops: [
            [-16, '#d73027'],
            [-12, '#f46d43'],
            [-8, '#fdae61'],
            [-4, '#fee08b'],
            [0, '#ffffbf'],
            [4, '#d9ef8b']
          ],
          },
        }
      }, 'motorway-casing-Major'
      );
      map.addLayer({
        "id": "AApEnrollDiffText",
        "type": "symbol",
        "source": "Cohort",
        "source-layer": "Cohort2006TEARegionPoints",
        "layout": {
          'visibility': 'visible',
          "text-field": "{AAEnrpD_}" + " pp",
          "text-font": [
            "DIN Offc Pro Medium",
            "Arial Unicode MS Bold"
          ],
          "text-size": 12
        }
      }
      );

      map.addLayer({
        'id': 'HisppEnrollDiff',
        'type': 'fill',
        'source': 'Cohort',
        'source-layer': 'Cohort2006TEARegionPolys',
        "layout": {
          'visibility': 'none'
        },
        'paint': {
          'fill-color': {
            property: 'HisEnrpDi', //Perc Point difference in enrollment                    type: 'exponential',
            stops: [
            [-16, '#d73027'],
            [-12, '#f46d43'],
            [-8, '#fdae61'],
            [-4, '#fee08b'],
            [0, '#ffffbf'],
            [4, '#d9ef8b']
          ],
          },
        }
      }, 'motorway-casing-Major'
      );
      map.addLayer({
        "id": "HisppEnrollDiffText",
        "type": "symbol",
        "source": "Cohort",
        "source-layer": "Cohort2006TEARegionPoints",
        "layout": {
          'visibility': 'none',
          "text-field": "{HisEnrpD_}" + " pp",
          "text-font": [
            "DIN Offc Pro Medium",
            "Arial Unicode MS Bold"
          ],
          "text-size": 12
        }
      }
      );
      map.addLayer({
        'id': 'AAmpEnrollDiff',
        'type': 'fill',
        'source': 'Cohort',
        'source-layer': 'Cohort2006TEARegionPolys',
        "layout": {
          'visibility': 'none'
        },
        'paint': {
          'fill-color': {
            property: 'AAmEnrpDi', //Perc Point difference in enrollment
            type: 'exponential',
            stops: [
            [-16, '#d73027'],
            [-12, '#f46d43'],
            [-8, '#fdae61'],
            [-4, '#fee08b'],
            [0, '#ffffbf'],
            [4, '#d9ef8b']
          ],
          },
        }
      }, 'motorway-casing-Major'
      );
      map.addLayer({
        "id": "AAmpEnrollDiffText",
        "type": "symbol",
        "source": "Cohort",
        "source-layer": "Cohort2006TEARegionPoints",
        "layout": {
          'visibility': 'none',
          "text-field": "{AAmEnrpD_}" + " pp",
          "text-font": [
            "DIN Offc Pro Medium",
            "Arial Unicode MS Bold"
          ],
          "text-size": 12
        }
      }
      );
      map.addLayer({
        'id': 'EcopEnrollDiff',
        'type': 'fill',
        'source': 'Cohort',
        'source-layer': 'Cohort2006TEARegionPolys',
        "layout": {
          'visibility': 'none'
        },
        'paint': {
          'fill-color': {
            property: 'EcoEnrpDi', //Perc Point difference in enrollment
            type: 'exponential',
            stops: [
            [-16, '#d73027'],
            [-12, '#f46d43'],
            [-8, '#fdae61'],
            [-4, '#fee08b'],
            [0, '#ffffbf'],
            [4, '#d9ef8b']
          ],
          },
        }
      }, 'motorway-casing-Major'
      );
      map.addLayer({
        "id": "EcopEnrollDiffText",
        "type": "symbol",
        "source": "Cohort",
        "source-layer": "Cohort2006TEARegionPoints",
        "layout": {
          'visibility': 'none',
          "text-field": "{EcoEnrpD_}" + " pp",
          "text-font": [
            "DIN Offc Pro Medium",
            "Arial Unicode MS Bold"
          ],
          "text-size": 12
        }
      }
      );
      map.addLayer({
        "id": "RegionLines",
        "type": "line",
        "source": "Cohort",
        "source-layer": "Cohort2006TEARegionPolys",
        "layout": {'visibility': 'visible'},
        paint: {
          "line-color": "#808080",
          "line-width": 1,
          "line-opacity": 0.3
          }
      }); 
      map.addSource("highlight", {
        'type': 'vector',
        'url': 'mapbox://johndinning.cvggpjmd'
      });
    map.addLayer({
      "id": "highlight-hover",
        "type": "fill",
        "source": "highlight",
        'source-layer': 'Cohort2006TEARegionPolys',
        "paint": {
            "fill-color": "#99ff99",
            "fill-opacity": .8
    },
        "filter": ['==',"TEAReg", ""]
    }, 'motorway-casing-Major');

    });

// </script>

  <div class='legend2'>
    <!-- see https://www.mapbox.com/mapbox-gl-js/example/updating-choropleth/ -->
   <div class="legend2-title">Percentage Point (pp) Difference from Overall Cohort</div>
     <div class="legend2keycontainer">
        <div class="legend2key"><span style='background-color: #d9ef8b'></span>+4</div>
        <div class="legend2key"><span style='background-color: #ffffbf'></span>0</div>
        <div class="legend2key"><span style='background-color: #fee08b'></span>-4</div>
        <div class="legend2key"><span style='background-color: #fdae61'></span>-8</div>
        <div class="legend2key"><span style='background-color: #f46d43'></span>-12</div>
        <div class="legend2key"><span style='background-color: #d73027'></span>-16</div>
     </div>
  </div>


  <script>
var popup = new mapboxgl.Popup({
  closeButton: false,
  closeOnClick: false
});


map.on("mousemove", "AApEnrollDiff", function(e) {
  map.setFilter("highlight-hover", ["==", "TEAReg", e.features[0].properties["TEAReg"]]);
  map.getCanvas().style.cursor = 'pointer';
  popup.setLngLat(e.lngLat)
      .setHTML('<strong>Enrollment Rates for the </strong><strong style="font-style: italic;">' + e.features[0].properties.RegName + ' Region</strong><table><tr style="font-weight: bold;"><td>Overall Cohort: </td><td>' + e.features[0].properties.TotpEnr.toFixed(1) + '%</td></tr><tr><td>African American: </td><td>' + e.features[0].properties.AApEnr.toFixed(1) + '%</td></tr><tr><td>Hispanic: </td><td>' + e.features[0].properties.HispEnr.toFixed(1) + '%</td></tr><tr><td>Economic Dis.: </td><td>' + e.features[0].properties.EcopEnr.toFixed(1) + '%</td></tr></p>')
      .addTo(map);
});

map.on("mouseleave", "AApEnrollDiff", function(e) {
  map.setFilter("highlight-hover", ["==", "TEAReg",""]);
  map.getCanvas().style.cursor = '';
  popup.remove();
});

map.on("mousemove", "AAmpEnrollDiff", function(e) {
  map.setFilter("highlight-hover", ["==", "TEAReg", e.features[0].properties["TEAReg"]]);
  map.getCanvas().style.cursor = 'pointer';
  popup.setLngLat(e.lngLat)
      .setHTML('<strong>Enrollment Rates for the </strong><strong style="font-style: italic;">' + e.features[0].properties.RegName + ' Region</strong><table><tr style="font-weight: bold;"><td>Overall Cohort: </td><td>' + e.features[0].properties.TotpEnr.toFixed(1) + '%</td></tr><tr><td>African American: </td><td>' + e.features[0].properties.AApEnr.toFixed(1) + '%</td></tr><tr><td>Hispanic: </td><td>' + e.features[0].properties.HispEnr.toFixed(1) + '%</td></tr><tr><td>Economic Dis.: </td><td>' + e.features[0].properties.EcopEnr.toFixed(1) + '%</td></tr></p>')
      .addTo(map);
});

map.on("mouseleave", "AAmpEnrollDiff", function(e) {
  map.setFilter("highlight-hover", ["==", "TEAReg",""]);
  map.getCanvas().style.cursor = '';
  popup.remove();
});

map.on("mousemove", "HisppEnrollDiff", function(e) {
  map.setFilter("highlight-hover", ["==", "TEAReg", e.features[0].properties["TEAReg"]]);
  map.getCanvas().style.cursor = 'pointer';
  popup.setLngLat(e.lngLat)
    .setHTML('<strong>Enrollment Rates for the </strong><strong style="font-style: italic;">' + e.features[0].properties.RegName + ' Region</strong><table><tr style="font-weight: bold;"><td>Overall Cohort: </td><td>' + e.features[0].properties.TotpEnr.toFixed(1) + '%</td></tr><tr><td>African American: </td><td>' + e.features[0].properties.AApEnr.toFixed(1) + '%</td></tr><tr><td>Hispanic: </td><td>' + e.features[0].properties.HispEnr.toFixed(1) + '%</td></tr><tr><td>Economic Dis.: </td><td>' + e.features[0].properties.EcopEnr.toFixed(1) + '%</td></tr></p>')
    .addTo(map);
});

map.on("mouseleave", "HisppEnrollDiff", function(e) {
  map.setFilter("highlight-hover", ["==", "TEAReg",""]);
  map.getCanvas().style.cursor = '';
  popup.remove();
});

map.on("mousemove", "EcopEnrollDiff", function(e) {
  map.setFilter("highlight-hover", ["==", "TEAReg", e.features[0].properties["TEAReg"]]);
  map.getCanvas().style.cursor = 'pointer';
  popup.setLngLat(e.lngLat)
    .setHTML('<strong>Enrollment Rates for the </strong><strong style="font-style: italic;">' + e.features[0].properties.RegName + ' Region</strong><table><tr style="font-weight: bold;"><td>Overall Cohort: </td><td>' + e.features[0].properties.TotpEnr.toFixed(1) + '%</td></tr><tr><td>African American: </td><td>' + e.features[0].properties.AApEnr.toFixed(1) + '%</td></tr><tr><td>Hispanic: </td><td>' + e.features[0].properties.HispEnr.toFixed(1) + '%</td></tr><tr><td>Economic Dis.: </td><td>' + e.features[0].properties.EcopEnr.toFixed(1) + '%</td></tr></p>')
    .addTo(map);
});

map.on("mouseleave", "EcopEnrollDiff", function(e) {
  map.setFilter("highlight-hover", ["==", "TEAReg",""]);
  map.getCanvas().style.cursor = '';
  popup.remove();
});
</script>

</body>
</html>